global G path T p dd dist speed T_b 
G = [
    0	300	360	210	590	475	500	690
    300	0	380	270	230	285	200	390
    360	380	0	510	230	765	580	770
    210	270	510	0	470	265	450	640
    590	230	230	470	0	515	260	450
    475	285	765	265	515	0	460	650
    500	200	580	450	260	460	0	190
    690	390	760	640	450	650	190	0
    ]/(100/6); % 邻接矩阵(行走时间)

n = factorial(6); % 所有可能的走法种类
path = [ones(n,1),perms(2:7),ones(n,1)*8]; % 所有可能的走法
c = [];
for i = 1:720
    if path(i,2) == 4
        c = [c,i];
    end
end
path(c,:) = [];
dist = zeros(1,size(path,1)); % 每种走法的距离
for i = 1:size(path,1) % 计算每种走法的总时间
    for j = 1:7
        dist(i) = dist(i) + G(path(i,j),path(i,j+1));
    end
end
options = gaoptimset('PopulationSize',5000,'Generations',1000,'StallGenLimit',1000); % 人口设为100，进化代数设为60

[~,z] = sort(dist);
path = path(z,:);dist = dist(z);nn = 24;
[a,b] = ga(@f,3*6+21,[],[],[],[],[1;14.6;58.4;57;27.4;52;  5;20;52.5;36;59;35.5;  6;19;24;59;43;59;  [2.5;2.4;1.2;1.9;2.5;2.2;1.3;   1;1;2.;2.9;2.9;2.9;2.9;  2.9;2;1.4;2.4;2.9;1.1;1.3]],...
     [1.6;14.7;58.9;57.9;27.9;52.9;  5.5;21;53.9;37.9;60;37;  6.5;20;25;60;43.9;60;  [2.7;2.6;1.4;2.1;2.9;2.5;1.8;   1.3;1.3;2.4;3;3;3;3;  3;2.4;1.7;2.6;3;1.2;1.5]],[],options);
 
% [a,b] = ga(@f,3*6+21,[],[],[],[],[1;14.66;58.47;57.12;27.45;52.3;  5;20;53.02;36.96;60;36.2;  6;19.91;24.84;59.79;43.36;60;  [2.62;2.55;1.36;2.02;2.81;2.43;1.7;   1.08;1.06;2.23;3;3;2.99;3;  3;2.23;1.68;2.53;3;1.14;1.34]],...
%      [1.5;14.66;58.47;57.12;27.45;52.3;  5.5;20;53.02;36.96;60;36.2;  6.5;19.91;24.84;59.79;43.36;60;  [2.62;2.55;1.36;2.02;2.81;2.43;1.7;   1.08;1.06;2.23;3;3;2.99;3;  3;2.23;1.68;2.53;3;1.14;1.34]],[],options);

 %     [1.5;20;60;60;60;60;5.5;20;60;60;60;60;6.5;20;60;60;60;60;ones(21,1)*3],[],options);

fprintf("");-f(a)
fprintf('路径::');p
fprintf("12:00\t0\t12:00\t%5.2f\t12:00\t0\t12:00\t%5.2f\t12:00\t0\t12:00\t%5.2f\n",a(18+1),a(18+1+7),a(18+1+14))
for i = 1:6
    for j = 1:3
        if i < 3
            c = a(i+1 + (j-1)*6);
        elseif i == 3
            c = 30;
        else
            c = a(i + (j-1)*6);
        end
        d = find(p(j,:) == i+1) - 1;
        fprintf('%02d:%-6.2f\t%-6.2f\t%02d:%-6.2f\t%5.2f\t',...
            floor(T(j,2*d-1)/60+12),mod(T(j,2*d-1),60),...
            c,...
            floor(T(j,2*d)/60+12),mod(T(j,2*d),60),...
            a(18 + (j-1)*7 + find(p(j,:)==i+1)))
    end
    fprintf('\n');
end
for j = 1:3
        fprintf('%02d:%-5.2f\t%-5.2f\t%02d:%-5.2f\t0\t',...
            floor(T(j,end)/60+12),mod(T(j,end),60),...
            30 + (300 - T(j,end)),...
            17,30)
end
fprintf("\n%5.2f\t%5.2f\t%5.2f\n",...
    sum(T_b(1,:)),sum(T_b(2,:)),sum(T_b(3,:)));
fprintf("%5.2f\t%5.2f\t%5.2f\n",...
    sum(a(2:6))+(360-T(1,end)),sum(a(8:12))+(360-T(2,end)),sum(a(14:18))+(360-T(3,end)));
fprintf("%5.2f\t%5.2f\t%5.2f\n",...
    330 - sum(a(2:6))-(360-T(1,end)) - sum(T_b(1,:)),330 - sum(a(8:12))-(360-T(2,end)) - sum(T_b(2,:)),330 - sum(a(14:18))-(360-T(3,end)) - sum(T_b(3,:)));
fprintf("%5.2f\t%5.2f\t%5.2f\n",...
    speed(1),speed(2),speed(3)); 